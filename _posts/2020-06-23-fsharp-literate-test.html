---
layout: page
title: Lazy Elmish React
---
<p>Recently I have been doing a fair amount with Fable-React-Elmish, and I have had really good results.
Quick time to production, little or no bugs. Overal I have been very happy with the toolchain. Now admittedly the apps
I have been producing are small, boring line of business apps. Basically just utilities or forms that essentailly are nothing
more than data entry. However the latest application I have had to produce was abit more involved. Basically there is a simple form
that has to query a API and then dispaly the data in a table with various levels of grouping. Armed with my recent successful experiences
with the Fable-Elmish-React toolset I was reasonably confident I could have something running in a few days. Which I did, and
I was pleased with my self.
UNTIL...
I started testing with more realistically sized datasets. And then I found out it was slow, like, really, really, slow. Over a second to render
a single key press. This was somewhat a surprise as everything you read about React says how blazing fast the Virtual DOM and rendering are.
In it's first cut I had a view which looked something like the following.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="id">view</span> <span class="id">model</span> <span class="id">dispatch</span> <span class="o">=</span> 
    <span class="id">R</span><span class="pn">.</span><span class="id">div</span> <span class="pn">[</span><span class="id">ClassName</span> <span class="s">&quot;col-md-12&quot;</span><span class="pn">]</span> <span class="pn">[</span>
        <span class="k">if</span> <span class="id">model</span><span class="pn">.</span><span class="id">Data</span><span class="pn">.</span><span class="id">Length</span> <span class="pn">&gt;</span> <span class="n">0</span> 
        <span class="k">then</span>
            <span class="k">yield</span> <span class="id">R</span><span class="pn">.</span><span class="id">form</span> <span class="pn">[</span><span class="id">ClassName</span> <span class="s">&quot;form form-inline col-md-12&quot;</span><span class="pn">;</span> <span class="id">Style</span> <span class="pn">[</span><span class="id">PaddingBottom</span> <span class="s">&quot;10px&quot;</span><span class="pn">]</span><span class="pn">]</span> <span class="pn">[</span>
                        <span class="id">R</span><span class="pn">.</span><span class="id">button</span> <span class="pn">[</span><span class="id">ClassName</span> <span class="s">&quot;btn btn-default col-md-1&quot;</span><span class="pn">;</span> 
                                   <span class="id">Disabled</span> <span class="pn">(</span><span class="id">model</span><span class="pn">.</span><span class="id">PendingChanged</span><span class="pn">.</span><span class="id">Length</span> <span class="o">=</span> <span class="n">0</span><span class="pn">)</span><span class="pn">;</span>
                                   <span class="id">OnClick</span> <span class="pn">(</span><span class="k">fun</span> <span class="id">x</span> <span class="k">-&gt;</span> <span class="id">x</span><span class="pn">.</span><span class="id">preventDefault</span><span class="pn">(</span><span class="pn">)</span><span class="pn">;</span>  <span class="id">dispatch</span> <span class="id">SaveChanges</span><span class="pn">)</span>
                                 <span class="pn">]</span> <span class="pn">[</span><span onmouseout="hideTip(event, 'fs7', 16)" onmouseover="showTip(event, 'fs7', 16)" class="id">unbox</span> <span class="s">&quot;Save Changes&quot;</span><span class="pn">]</span>

                        <span class="id">R</span><span class="pn">.</span><span class="id">input</span> <span class="pn">[</span> <span class="id">Id</span> <span class="s">&quot;selectedentity&quot;</span><span class="pn">;</span> 
                                  <span class="id">ClassName</span> <span class="s">&quot;form-control&quot;</span><span class="pn">;</span> 
                                  <span class="id">Style</span><span class="pn">[</span><span class="id">MarginLeft</span> <span class="s">&quot;20px&quot;</span><span class="pn">]</span><span class="pn">;</span> 
                                  <span class="id">Placeholder</span> <span class="s">&quot;Select Entity&quot;</span><span class="pn">;</span> 
                                  <span class="id">Value</span> <span class="id">model</span><span class="pn">.</span><span class="id">Entity</span><span class="pn">]</span>
                <span class="pn">]</span>
       
        <span class="k">yield</span> <span class="id">R</span><span class="pn">.</span><span class="id">div</span> <span class="pn">[</span><span class="id">ClassName</span> <span class="s">&quot;col-md-12 table-responsive&quot;</span><span class="pn">]</span> <span class="pn">[</span>
                   <span class="k">if</span> <span class="id">model</span><span class="pn">.</span><span class="id">Data</span><span class="pn">.</span><span class="id">Length</span> <span class="pn">&gt;</span> <span class="n">0</span> 
                   <span class="k">then</span>
                      <span class="k">yield</span> <span class="id">bootstrapTable</span> <span class="pn">[</span>
                          <span class="id">KeyField</span> <span class="s">&quot;id&quot;</span>
                          <span onmouseout="hideTip(event, 'fs3', 17)" onmouseover="showTip(event, 'fs3', 17)" class="id">Data</span> <span class="id">model</span><span class="pn">.</span><span class="id">Data</span>
                          <span class="id">Columns</span> <span class="id">model</span><span class="pn">.</span><span class="id">Columns</span>
                          <span class="id">CellEdit</span> <span class="pn">(</span><span class="id">CellEditFactory</span><span class="pn">(</span>
                            <span class="pn">[</span>
                              <span class="s">&quot;mode&quot;</span> <span class="o">==&gt;</span> <span class="s">&quot;click&quot;</span>
                              <span class="s">&quot;afterSaveCell&quot;</span> <span class="o">==&gt;</span> <span onmouseout="hideTip(event, 'fs8', 18)" onmouseover="showTip(event, 'fs8', 18)" class="id">ignore</span>
                            <span class="pn">]</span> <span class="o">|&gt;</span> <span class="id">createObj</span><span class="pn">)</span><span class="pn">)</span>
                      <span class="pn">]</span>
                   <span class="k">else</span> 
                     <span class="k">yield</span> <span class="id">R</span><span class="pn">.</span><span class="id">h1</span> <span class="pn">[</span><span class="id">Style</span> <span class="pn">[</span><span class="id">BackgroundColor</span> <span class="s">&quot;#eeeeee&quot;</span><span class="pn">;</span> <span class="id">TextAlign</span> <span class="s">&quot;center&quot;</span><span class="pn">;</span> <span class="id">Height</span> <span class="s">&quot;100%&quot;</span><span class="pn">]</span><span class="pn">]</span> <span class="pn">[</span><span class="id">R</span><span class="pn">.</span><span class="id">str</span> <span class="s">&quot;No Data!&quot;</span><span class="pn">]</span>
              <span class="pn">]</span>
    <span class="pn">]</span>
</code></pre></td>
</tr>
</table>


<div class="tip" id="fs1">type obj = System.Object</div>
<div class="tip" id="fs2">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />--------------------<br />type string = System.String</div>
<div class="tip" id="fs3">namespace Microsoft.FSharp.Data</div>
<div class="tip" id="fs4">type &#39;T list = List&lt;&#39;T&gt;</div>
<div class="tip" id="fs5">module Unchecked<br /><br />from Microsoft.FSharp.Core.Operators</div>
<div class="tip" id="fs6">val defaultof&lt;&#39;T&gt; : &#39;T</div>
<div class="tip" id="fs7">val unbox : value:obj -&gt; &#39;T</div>
<div class="tip" id="fs8">val ignore : value:&#39;T -&gt; unit</div>
