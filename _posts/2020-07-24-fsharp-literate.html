<h1>Literate F#</h1>
<p>Up until now, I've mostly written my blog posts directly in markdown, and including code
snippets copied from fsx files.</p>
<p>Literate programming has existed for a while in the F# ecosystem, although I always found
it clunky to use, probably because it hasn't been updated for a while.  However Don Syme
gave it a refresh last week, which has made it far more usable, especially as a Mac user.</p>
<p>This purpose of this post is to:
<em> detail how I use Literate within my posts
</em> remind me how to use it</p>
<h2>My Blog</h2>
<p>I use GitHub's Jekyll as a 'blog engine'.  This a static blog engine, which means that
you write posts in markdown, submit to your repository which the blog engine renders in html.</p>
<p>This is works well and F# code is rendered resonably well.</p>
<p>However a few people seems to be using Literate programming and the associated tools in F#
in order to generate html files directly, and then post to Jekyll.</p>
<p>I tool my workflow from Colin Bull's <a href="http://www.colinbull.net/2014/11/04/Blogging-with-FSharp/">blog</a> post, and associated github repository,
although I updated all dlls to the latest version of FSharp.Formatting.</p>
<h2>FSX</h2>
<p>The recipe that I follow, is to write the post within a F# script file (.fsx).</p>
<p>Start with a double asterisk comment, which allows you to write standard Markdown.</p>
<p>As as example, you can write lists:</p>
<ul>
<li>Unordered or ordered lists</li>
<li>Text formatting including <strong>bold</strong> and <em>emphasis</em></li>
</ul>
<p>And numerous other <a href="http://daringfireball.net/projects/markdown">Markdown</a> features.</p>
<h2>Writing F# code</h2>
<p>Code that is not inside comment will be formatted as a sample snippet
(which also means that you can run it in Visual Studio Code or editor of your choosing).</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">/// The Hello World of functional languages!</span>
<span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="fn">factorial</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="id">x</span> <span class="o">=</span>
    <span class="k">if</span> <span onmouseout="hideTip(event, 'fs2', 3)" onmouseover="showTip(event, 'fs2', 3)" class="id">x</span> <span class="o">=</span> <span class="n">0</span> <span class="k">then</span> <span class="n">1</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs2', 4)" onmouseover="showTip(event, 'fs2', 4)" class="id">x</span> <span class="o">*</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs1', 5)" onmouseover="showTip(event, 'fs1', 5)" class="fn">factorial</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs2', 6)" onmouseover="showTip(event, 'fs2', 6)" class="id">x</span> <span class="o">-</span> <span class="n">1</span><span class="pn">)</span><span class="pn">)</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 7)" onmouseover="showTip(event, 'fs3', 7)" class="id">f10</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs1', 8)" onmouseover="showTip(event, 'fs1', 8)" class="fn">factorial</span> <span class="n">10</span>
</code></pre></td>
</tr>
</table>
<p>You can then write more blog content.  And also some more code:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs4', 9)" onmouseover="showTip(event, 'fs4', 9)" class="fn">listToString</span> <span onmouseout="hideTip(event, 'fs5', 10)" onmouseover="showTip(event, 'fs5', 10)" class="id">l</span> <span class="o">=</span> 
  <span class="k">match</span> <span onmouseout="hideTip(event, 'fs5', 11)" onmouseover="showTip(event, 'fs5', 11)" class="id">l</span> <span class="k">with</span>
  <span class="pn">|</span> <span class="pn">[</span><span class="pn">]</span> <span class="k">-&gt;</span> <span class="s">&quot;&quot;</span>
  <span class="pn">|</span> <span onmouseout="hideTip(event, 'fs6', 12)" onmouseover="showTip(event, 'fs6', 12)" class="id">head</span> <span class="uc">::</span> <span onmouseout="hideTip(event, 'fs7', 13)" onmouseover="showTip(event, 'fs7', 13)" class="id">tail</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs6', 14)" onmouseover="showTip(event, 'fs6', 14)" class="fn">head</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs8', 15)" onmouseover="showTip(event, 'fs8', 15)" class="id">ToString</span><span class="pn">(</span><span class="pn">)</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs4', 16)" onmouseover="showTip(event, 'fs4', 16)" class="fn">listToString</span> <span onmouseout="hideTip(event, 'fs7', 17)" onmouseover="showTip(event, 'fs7', 17)" class="id">tail</span>
</code></pre></td>
</tr>
</table>
<h2>Posting to blog</h2>
<p>Before posting to my blog repository on github, we need to convert from fsx to a html file.
This can be achieved through FSharp.Formatting.Literate as such.</p>
<p>Create a new fsx file with the following content.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="pp">#I</span> <span class="s">&quot;../tools&quot;</span>
<span class="pp">#r</span> <span class="s">&quot;FSharp.Formatting.Common.dll&quot;</span>
<span class="pp">#r</span> <span class="s">&quot;FSharp.Formatting.Markdown.dll&quot;</span>
<span class="pp">#r</span> <span class="s">&quot;FSharp.Formatting.Literate.dll&quot;</span>
<span class="pp">#r</span> <span class="s">&quot;FSharp.Formatting.CodeFormat.dll&quot;</span>

<span class="k">open</span> <span onmouseout="hideTip(event, 'fs9', 18)" onmouseover="showTip(event, 'fs9', 18)" class="id">FSharp</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs10', 19)" onmouseover="showTip(event, 'fs10', 19)" class="id">Formatting</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs11', 20)" onmouseover="showTip(event, 'fs11', 20)" class="id">Literate</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 21)" onmouseover="showTip(event, 'fs12', 21)" class="id">source</span> <span class="o">=</span> <span class="k">__SOURCE_DIRECTORY__</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 22)" onmouseover="showTip(event, 'fs13', 22)" class="id">codeDirectory</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs12', 23)" onmouseover="showTip(event, 'fs12', 23)" class="id">source</span> <span class="o">+</span> <span class="s">&quot;/code&quot;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs14', 24)" onmouseover="showTip(event, 'fs14', 24)" class="id">outputDirectory</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs12', 25)" onmouseover="showTip(event, 'fs12', 25)" class="id">source</span> <span class="o">+</span> <span class="s">&quot;/_posts&quot;</span>

<span class="c">//process directory, moving files from code to the _posts directory.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs15', 26)" onmouseover="showTip(event, 'fs15', 26)" class="fn">processDirectory</span> <span class="pn">(</span><span class="pn">)</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs16', 27)" onmouseover="showTip(event, 'fs16', 27)" class="rt">Literate</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs17', 28)" onmouseover="showTip(event, 'fs17', 28)" class="id">ConvertDirectory</span><span class="pn">(</span><span class="id">input</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 29)" onmouseover="showTip(event, 'fs13', 29)" class="id">codeDirectory</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs14', 30)" onmouseover="showTip(event, 'fs14', 30)" class="id">outputDirectory</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs14', 31)" onmouseover="showTip(event, 'fs14', 31)" class="id">outputDirectory</span><span class="pn">)</span>

<span class="k">do</span> <span onmouseout="hideTip(event, 'fs15', 32)" onmouseover="showTip(event, 'fs15', 32)" class="fn">processDirectory</span> <span class="pn">(</span><span class="pn">)</span>
</code></pre></td>
</tr>
</table>
<p>This assumes that:
<em> the dlls are in the tools directory
</em> fsx files are in the code directory
* generated html files will be in the _posts directory</p>
<p>The script will process all fsx files in the code directory and create the html files in
the _posts directory.</p>
<p>You can then run the script from the command line as follows</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip"><code lang="bash">dotnet fsi yourscriptname.fsx
</code></pre></td></tr></table>


<div class="tip" id="fs1">val factorial : x:int -&gt; int<br /><em><br /><br />&#160;The Hello World of functional languages!</em></div>
<div class="tip" id="fs2">val x : int</div>
<div class="tip" id="fs3">val f10 : int</div>
<div class="tip" id="fs4">val listToString : l:&#39;a list -&gt; string</div>
<div class="tip" id="fs5">val l : &#39;a list</div>
<div class="tip" id="fs6">val head : &#39;a</div>
<div class="tip" id="fs7">val tail : &#39;a list</div>
<div class="tip" id="fs8">System.Object.ToString() : string</div>
<div class="tip" id="fs9">Multiple items<br />namespace FSharp<br /><br />--------------------<br />namespace Microsoft.FSharp</div>
<div class="tip" id="fs10">namespace FSharp.Formatting</div>
<div class="tip" id="fs11">namespace FSharp.Formatting.Literate</div>
<div class="tip" id="fs12">val source : string</div>
<div class="tip" id="fs13">val codeDirectory : string</div>
<div class="tip" id="fs14">val outputDirectory : string</div>
<div class="tip" id="fs15">val processDirectory : unit -&gt; unit</div>
<div class="tip" id="fs16">type Literate =<br />&#160;&#160;private new : unit -&gt; Literate<br />&#160;&#160;static member ConvertDirectory : input:string * ?htmlTemplate:string * ?outputDirectory:string * ?formatAgent:CodeFormatAgent * ?prefix:string * ?fscoptions:string * ?lineNumbers:bool * ?references:bool * ?fsiEvaluator:IFsiEvaluator * ?parameters:(string * string) list * ?generateAnchors:bool * ?recursive:bool * ?customizeDocument:(LiterateProcessingContext -&gt; LiterateDocument -&gt; LiterateDocument) * ?tokenKindToCss:(TokenKind -&gt; string) * ?saveImages:bool * ?extraInputs:(string * string) list -&gt; unit<br />&#160;&#160;static member ConvertMarkdownFile : input:string * ?template:string * ?output:string * ?outputKind:OutputKind * ?formatAgent:CodeFormatAgent * ?prefix:string * ?fscoptions:string * ?lineNumbers:bool * ?references:bool * ?parameters:(string * string) list * ?generateAnchors:bool * ?customizeDocument:(LiterateProcessingContext -&gt; LiterateDocument -&gt; LiterateDocument) * ?saveImages:bool -&gt; unit<br />&#160;&#160;static member ConvertScriptFile : input:string * ?template:string * ?output:string * ?outputKind:OutputKind * ?formatAgent:CodeFormatAgent * ?prefix:string * ?fscoptions:string * ?lineNumbers:bool * ?references:bool * ?fsiEvaluator:IFsiEvaluator * ?parameters:(string * string) list * ?generateAnchors:bool * ?customizeDocument:(LiterateProcessingContext -&gt; LiterateDocument -&gt; LiterateDocument) * ?saveImages:bool -&gt; unit<br />&#160;&#160;static member FormatLiterateNodes : doc:LiterateDocument * ?outputKind:OutputKind * ?prefix:string * ?lineNumbers:bool * ?generateAnchors:bool * ?tokenKindToCss:(TokenKind -&gt; string) -&gt; LiterateDocument<br />&#160;&#160;static member private ParseAndTransformMarkdownFile : input:string * ?output:string * ?outputKind:OutputKind * ?formatAgent:CodeFormatAgent * ?prefix:string * ?fscoptions:string * ?lineNumbers:bool * ?references:bool * ?parameters:(string * string) list * ?generateAnchors:bool * ?customizeDocument:(LiterateProcessingContext -&gt; LiterateDocument -&gt; LiterateDocument) * ?tokenKindToCss:(TokenKind -&gt; string) * ?imageSaver:(string -&gt; string) -&gt; LiterateDocModel<br />&#160;&#160;static member private ParseAndTransformScriptFile : input:string * ?output:string * ?outputKind:OutputKind * ?formatAgent:CodeFormatAgent * ?prefix:string * ?fscoptions:string * ?lineNumbers:bool * ?references:bool * ?fsiEvaluator:IFsiEvaluator * ?parameters:(string * string) list * ?generateAnchors:bool * ?customizeDocument:(LiterateProcessingContext -&gt; LiterateDocument -&gt; LiterateDocument) * ?tokenKindToCss:(TokenKind -&gt; string) * ?imageSaver:(string -&gt; string) -&gt; LiterateDocModel<br />&#160;&#160;static member ParseMarkdownFile : path:string * ?formatAgent:CodeFormatAgent * ?fscoptions:string * ?definedSymbols:string list * ?references:bool * ?fsiEvaluator:IFsiEvaluator * ?parseOptions:MarkdownParseOptions -&gt; LiterateDocument<br />&#160;&#160;static member ParseMarkdownString : content:string * ?path:string * ?formatAgent:CodeFormatAgent * ?fscoptions:string * ?definedSymbols:string list * ?references:bool * ?fsiEvaluator:IFsiEvaluator * ?parseOptions:MarkdownParseOptions -&gt; LiterateDocument<br />&#160;&#160;static member ParseScriptFile : path:string * ?formatAgent:CodeFormatAgent * ?fscoptions:string * ?definedSymbols:string list * ?references:bool * ?fsiEvaluator:IFsiEvaluator * ?parseOptions:MarkdownParseOptions -&gt; LiterateDocument<br />&#160;&#160;...</div>
<div class="tip" id="fs17">static member Literate.ConvertDirectory : input:string * ?htmlTemplate:string * ?outputDirectory:string * ?formatAgent:FSharp.Formatting.CodeFormat.CodeFormatAgent * ?prefix:string * ?fscoptions:string * ?lineNumbers:bool * ?references:bool * ?fsiEvaluator:Evaluation.IFsiEvaluator * ?parameters:(string * string) list * ?generateAnchors:bool * ?recursive:bool * ?customizeDocument:(LiterateProcessingContext -&gt; LiterateDocument -&gt; LiterateDocument) * ?tokenKindToCss:(FSharp.Formatting.CodeFormat.TokenKind -&gt; string) * ?saveImages:bool * ?extraInputs:(string * string) list -&gt; unit</div>
